template: http://git.app.eng.bos.redhat.com/git/openshift-misc.git/plain/v3-launch-templates/system-testing/aos-39/aws/template.ose39-aws-svt

rhel_roles:
- master
- node
- router
- registry
- etcd
- pbench-controller
#- nfs

iaas_name: AWS
aws_access_key: AKIAISUIUTCJPFZPA42Q
aws_secret_key: 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
master_etcd_instance_count: 1
master_etcd_instance_type: m4.xlarge
master_instance_count: 0
master_instance_type: m4.xlarge
etcd_instance_count: 0
etcd_instance_type: m4.xlarge
lb_instance_count: 0
lb_instance_type: t2.medium
infra_instance_count: 1
infra_instance_type: m4.xlarge
node_instance_count: 2
node_instance_type: m4.xlarge

# For pbench-controller
pbench_controller_count: 0
pbench_controller_type: t2.large

# no need to update OS since we're using pre-baked gold images which have been recently updated.
# if you have a custom repo that's newer than the gold images, i.e. a custom kernel or something.
# openshift_additional_repos=[{'id': 'rhel7-latest', 'name': 'rhel7-latest', 'baseurl': 'http://example.com/puddle/build/AtomicOpenShift/3.1/latest/RH7-RHOSE-3.0/$basearch/os', 'enabled': 1, 'gpgcheck': 0}]
os_update: false
use_rpm_playbook: yes
openshift_playbook_rpm_repos: "[{'id': 'aos-playbook-rpm', 'name': 'aos-playbook-rpm', 'baseurl': 'http://download.eng.bos.redhat.com/rcm-guest/puddles/RHAOS/AtomicOpenShift/3.9/latest/x86_64/os', 'enabled': 1, 'gpgcheck': 0}]"
auth_type: allowall
openshift_master_default_subdomain_enable: true
enable_cloudprovider: true
run_aws_install_prep: false
openshift_schedulable: true

aos_ansible_vars:
  aos_repo: https://mirror.openshift.com/enterprise/all/3.9/latest/RH7-RHAOS-3.9/x86_64/os
  reg_username: "{{ lookup('env','REG_AUTH_USER') }}" 
  reg_password: "{{ lookup('env','REG_AUTH_PASSWORD') }}" 

openshift_ansible_vars:
  openshift_release: v3.9
  openshift_deployment_type: openshift-enterprise
  openshift_cockpit_deployer_prefix: "registry.reg-aws.openshift.com:443/openshift3/"
  oreg_url: "registry.reg-aws.openshift.com:443/openshift3/ose-${component}:${version}"
  oreg_auth_user: "{{ lookup('env','REG_AUTH_USER') }}"
  oreg_auth_password: "{{ lookup('env','REG_AUTH_PASSWORD') }}"
  openshift_docker_additional_registries: "registry.reg-aws.openshift.com:443"
  openshift_docker_insecure_registries: "registry.reg-aws.openshift.com:443"
  openshift_service_catalog_image_prefix:  "registry.reg-aws.openshift.com:443/openshift3/ose-"
  ansible_service_broker_image_prefix: registry.reg-aws.openshift.com:443/openshift3/ose-
  ansible_service_broker_image_tag: v3.9
  template_service_broker_selector: '{"region": "infra"}'
  template_service_broker_prefix: registry.reg-aws.openshift.com:443/openshift3/ose-
  template_service_broker_version: v3.9
  openshift_web_console_prefix: registry.reg-aws.openshift.com:443/openshift3/ose-
  openshift_enable_service_catalog: true

  osm_cockpit_plugins: "['cockpit-kubernetes']"
  osm_use_cockpit: false
  openshift_docker_options: '--log-opt max-size=100M --log-opt max-file=3 --signature-verification=false'
  use_cluster_metrics: true
  openshift_master_cluster_method: native
  openshift_master_dynamic_provisioning_enabled: True
  openshift_hosted_router_registryurl: 'registry.reg-aws.openshift.com:443/openshift3/ose-${component}:${version}'
  openshift_hosted_registry_registryurl: 'registry.reg-aws.openshift.com:443/openshift3/ose-${component}:${version}'
  #openshift_hosted_registry_registryurl: 'registry.reg-aws.openshift.com:443/openshift3/ose-${component}:${version}'

# Set default node selector
  osm_default_node_selector: "region=primary"
  openshift_registry_selector: '"region=infra,zone=default"'
  openshift_hosted_router_selector: '"region=infra,zone=default"'

# Disable disk space amd memory checks during installation
  openshift_disable_check: disk_availability,memory_availability,package_availability,docker_image_availability,docker_storage,package_version

# Allows for 1000 nodes, each with a /24
# Change osm_host_subnet_length: 9 allows 512 nodes, each with a /23.
  openshift_master_portal_net: 172.24.0.0/14
  openshift_portal_net: 172.24.0.0/14
  osm_cluster_network_cidr: 172.20.0.0/14
  osm_host_subnet_length: 9

# openshift_node_kubelet_args: '{"pods-per-core": ["0"], "max-pods": ["510"], "image-gc-high-threshold": ["80"], "image-gc-low-threshold": ["70"]}'
  openshift_node_kubelet_args: '{"pods-per-core": ["0"], "max-pods": ["510"]}'
#  openshift_hosted_router_registryurl: 'registry.ops.openshift.com/openshift3/ose-${component}:${version}'
  debug_level: 2
  openshift_set_hostname: true
  openshift_override_hostname_check: true
  os_sdn_network_plugin_name: 'redhat/openshift-ovs-networkpolicy'
  openshift_hosted_router_replicas: 1

# If you use an S3-based registry
  openshift_hosted_registry_storage_kind: object
  openshift_hosted_registry_storage_provider: s3

# specify your AWS creds in the launcher vars
#  openshift_hosted_registry_storage_s3_accesskey: "{{ lookup('env','AWS_ACCESS_KEY_ID') }}"
#  openshift_hosted_registry_storage_s3_secretkey: "{{ lookup('env','AWS_SECRET_ACCESS_KEY') }}"
  openshift_hosted_registry_storage_s3_accesskey: AKIAISUIUTCJPFZPA42Q
  openshift_hosted_registry_storage_s3_secretkey: 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
# s3 bucket must be created first.  Use that name here.
  openshift_hosted_registry_storage_s3_bucket: aoe-svt-test
  openshift_hosted_registry_storage_s3_region: us-east-1d
  openshift_hosted_registry_replicas: 1

  openshift_hosted_prometheus_deploy: true
  openshift_prometheus_image_prefix: registry.reg-aws.openshift.com:443/openshift3/ 
  openshift_prometheus_image_version: v3.9
  openshift_prometheus_proxy_image_prefix: registry.reg-aws.openshift.com:443/openshift3/ 
  openshift_prometheus_proxy_image_version: v3.9
  openshift_prometheus_alertmanager_image_prefix: registry.reg-aws.openshift.com:443/openshift3/ 
  openshift_prometheus_alertmanager_image_version: v3.9
  openshift_prometheus_alertbuffer_image_prefix: registry.reg-aws.openshift.com:443/openshift3/ 
  openshift_prometheus_alertbuffer_image_version: v3.9

# Metrics
  openshift_metrics_install_metrics: false
#  openshift_metrics_image_prefix: registry.ops.openshift.com/openshift3/
  openshift_metrics_image_prefix: 'registry.reg-aws.openshift.com:443/openshift3/'
  openshift_metrics_image_version: v3.9
  openshift_metrics_cassandra_storage_type: dynamic
  openshift_metrics_cassandra_pvc_size: 25Gi

# Logging
  openshift_logging_install_logging: false
#  openshift_logging_image_prefix: registry.ops.openshift.com/openshift3/
  openshift_logging_image_prefix: 'registry.reg-aws.openshift.com:443/openshift3/'
  openshift_logging_image_version: v3.9
  openshift_logging_storage_kind: dynamic
  openshift_logging_es_pvc_size: 50Gi
  openshift_logging_es_pvc_dynamic: true
  openshift_logging_curator_nodeselector: '{"region": "infra"}'
  openshift_logging_kibana_nodeselector: '{"region": "infra"}'
  openshift_logging_es_nodeselector: '{"region": "infra"}'
